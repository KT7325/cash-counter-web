<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Counter & Word Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="config.js"></script>
    <style>
        footer {
            text-align: center;
            padding: 20px;
            background-color: var(--bg-cream);
        }

        footer p {
            margin: 0;
            color: var(--text-light);
            font-size: 14px;
        }

        footer b {
            color: var(--primary-red);
        }
    </style>
</head>

<body class="bg-gray-100 p-4 md:p-10 font-sans">

    <div class="max-w-6xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

            <section>
                <div class="flex justify-between items-center mb-4 border-b-4 border-emerald-500 pb-2">
                    <h2 class="text-2xl font-bold flex items-center gap-2">
                        <i class="fa-solid fa-money-bill-1-wave text-emerald-500 text-center"></i>Cash Counter
                    </h2>
                    <a href="index.html" class="text-emerald-500 hover:text-emerald-700 text-2xl">
                        <i class="fa-solid fa-house"></i>
                    </a>
                </div>
                
                <div id="notes-container" class="space-y-3">
                    <template id="row-template">
                        <div class="flex items-center justify-between p-3 rounded-lg border-l-4">
                            <span class="font-bold text-lg label-text"></span>
                            <div class="flex items-center gap-4">
                                <input type="number" min="0" value="" placeholder="0" inputmode="numeric" pattern="[0-9]*" class="w-20 p-2 border rounded text-center focus:ring-2 outline-none count-input">
                                <span class="font-bold text-lg min-w-[60px] text-right row-total">0</span>
                            </div>
                        </div>
                    </template>
                </div>
                
                <div id="coins-container" class="space-y-3 mt-6 mb-8"></div>



                <div class="mt-auto bg-gradient-to-r from-emerald-500 to-blue-600 text-white p-8 rounded-2xl shadow-lg">
                    <div class="mb-4 rounded-lg backdrop-blur-sm flex flex-col gap-3">
                        <div class="flex justify-center">
                             <input type="date" id="date-input" class="p-2 px-6 rounded-lg focus:ring-2 outline-none text-gray-700 text-lg font-semibold bg-white shadow-md" />
                        </div>
                    </div>

                    <div class="text-xl flex justify-center items-center gap-2 mb-2 text-white/90 font-semibold mt-2">
                     Total Amount
                    </div>
                    <div id="grand-total" class="text-5xl font-black mb-4 text-center w-full">0</div>

                    <div class="pt-4 border-t border-white/20">
                        <span class="text-sm tracking-widest opacity-80 font-bold text-white">In Words:</span>
                        <div id="total-in-words" class="text-lg font-medium italic mt-1 capitalize leading-tight"></div>
                    </div>
                </div>

                <!-- New Fields Block -->
                <div class="bg-gray-50 p-5 rounded-xl border border-gray-200 mb-6 shadow-sm mt-8">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-pen-to-square text-emerald-500"></i> Additional Details
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Week Expenses</label>
                            <input type="number" id="week-expenses-input" placeholder="0.00" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 outline-none transition bg-white shadow-sm" />
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Adjust Amount</label>
                            <input type="number" id="adjust-amount-input" placeholder="0.00" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 outline-none transition bg-white shadow-sm" />
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">ATM Withdrawal</label>
                            <input type="number" id="atm-withdrawal-input" placeholder="0.00" inputmode="numeric" pattern="[0-9]*" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 outline-none transition bg-white shadow-sm" />
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">A/C Paid</label>
                            <input type="number" id="ac-paid-input" placeholder="0.00" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 outline-none transition bg-white shadow-sm" />
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Remarks</label>
                            <input type="text" id="remarks-input" placeholder="Enter remarks..." class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 outline-none transition bg-white shadow-sm" />
                        </div>
                    </div>
                </div>

                <div class="flex justify-between gap-4 mt-6">
                    <button onclick="clearAll()" class="bg-red-500 hover:bg-red-600 text-white py-3 px-6 rounded-xl font-bold flex items-center justify-center gap-2 transition">
                        <i class="fa-solid fa-trash"></i> Clear All
                    </button>
                    <button onclick="saveData()" id="save-btn" class="bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-xl font-bold flex items-center justify-center gap-2 transition">
                        <i class="fa-solid fa-floppy-disk"></i> Done
                    </button>
                </div>
                
                <div id="loader" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
                    <div class="bg-white p-8 rounded-2xl shadow-2xl flex flex-col items-center gap-4">
                        <div class="animate-spin">
                            <i class="fa-solid fa-spinner text-4xl text-green-500"></i>
                        </div>
                        <p class="text-gray-700 font-semibold">(S) Clearing data...</p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        const denominations = {
            notes: [{
                    val: 500,
                    color: 'border-blue-500 bg-blue-50 text-blue-700'
                },
                {
                    val: 200,
                    color: 'border-orange-500 bg-orange-50 text-orange-700'
                },
                {
                    val: 100,
                    color: 'border-emerald-500 bg-emerald-50 text-emerald-700'
                },
                {
                    val: 50,
                    color: 'border-pink-500 bg-pink-50 text-pink-700'
                },
                {
                    val: 20,
                    color: 'border-indigo-500 bg-indigo-50 text-indigo-700'
                },
                {
                    val: 10,
                    color: 'border-red-500 bg-red-50 text-red-700'
                }
            ],
            coins: [{
                    val: 5,
                    color: 'border-slate-400 bg-orange-50 text-slate-700'
                },
                {
                    val: 2,
                    color: 'border-slate-300 bg-blue-50 text-slate-700'
                },
                {
                    val: 1,
                    color: 'border-slate-200 bg-pink-50 text-slate-700'
                }
            ]
        };

        function init() {
            // Set up date picker
            const dateInput = document.getElementById('date-input');
            const today = new Date().toISOString().split('T')[0];
            
            dateInput.value = today;
            dateInput.max = today;
            
            renderSection('notes-container', denominations.notes, '');
            renderSection('coins-container', denominations.coins, '');

            document.getElementById('week-expenses-input').addEventListener('input', calculate);
            document.getElementById('adjust-amount-input').addEventListener('input', calculate);
            document.getElementById('atm-withdrawal-input').addEventListener('input', calculate);
        }

        function renderSection(containerId, list, suffix) {
            const container = document.getElementById(containerId);
            const template = document.getElementById('row-template');

            list.forEach(item => {
                const clone = template.content.cloneNode(true);
                const wrapper = clone.querySelector('div');
                wrapper.className += ` ${item.color}`;
                clone.querySelector('.label-text').textContent = suffix ? `${item.val} ${suffix}` : `${item.val}`;

                const input = clone.querySelector('.count-input');
                input.dataset.value = item.val;
                input.addEventListener('input', calculate);
                container.appendChild(clone);
            });
        }

        function calculate() {
            let grandTotal = 0;
            const inputs = document.querySelectorAll('.count-input');

            inputs.forEach(input => {
                const count = parseInt(input.value) || 0;
                const multiplier = parseInt(input.dataset.value);
                const rowTotal = count * multiplier;
                grandTotal += rowTotal;
                input.nextElementSibling.textContent = `${rowTotal}`;
            });

            document.getElementById('grand-total').textContent = `Rs. ${grandTotal}`;
            document.getElementById('total-in-words').textContent = numberToWords(grandTotal) + " Rupees Only";

            const weekExpenses = parseFloat(document.getElementById('week-expenses-input').value) || 0;
            const adjustAmount = parseFloat(document.getElementById('adjust-amount-input').value) || 0;
            const acPaid = (grandTotal + adjustAmount) - weekExpenses;
            document.getElementById('ac-paid-input').value = acPaid;
        }

        // Function to convert Number to Indian Word System
        function numberToWords(num) {
            if (num === 0) return "Zero";

            const a = ['', 'one ', 'two ', 'three ', 'four ', 'five ', 'six ', 'seven ', 'eight ', 'nine ', 'ten ', 'eleven ', 'twelve ', 'thirteen ', 'fourteen ', 'fifteen ', 'sixteen ', 'seventeen ', 'eighteen ', 'nineteen '];
            const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];

            const format = (n, suffix) => {
                if (n === 0) return "";
                let str = "";
                if (n > 19) {
                    str += b[Math.floor(n / 10)] + " " + a[n % 10];
                } else {
                    str += a[n];
                }
                return str + suffix;
            };

            let res = "";
            res += format(Math.floor(num / 10000000), "Crore ");
            res += format(Math.floor((num / 100000) % 100), "Lakh ");
            res += format(Math.floor((num / 1000) % 100), "Thousand ");
            res += format(Math.floor((num / 100) % 10), "Hundred ");

            if (num > 100 && num % 100 !== 0) res += "and ";
            res += format(num % 100, "");

            return res.trim();
        }

        function clearAll() {
            document.querySelectorAll('.count-input').forEach(input => input.value = "");
            document.getElementById('week-expenses-input').value = "";
            document.getElementById('adjust-amount-input').value = "";
            document.getElementById('atm-withdrawal-input').value = "";
            document.getElementById('ac-paid-input').value = "";
            document.getElementById('remarks-input').value = "";
            calculate();
        }
        function formatDateToDDMMMYYYY(isoDate) {
            if (!isoDate) return '';
            const d = new Date(isoDate);
            if (isNaN(d)) return isoDate;
            const day = String(d.getDate()).padStart(2, '0');
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${day}/${months[d.getMonth()]}/${d.getFullYear()}`;
        }

        function saveData() {
            const loader = document.getElementById('loader');
            const saveBtn = document.getElementById('save-btn');
            loader.classList.remove('hidden');
            saveBtn.disabled = true;
            
            const dateInput = document.getElementById('date-input');
            const weekExpensesInput = document.getElementById('week-expenses-input');
            const adjustAmountInput = document.getElementById('adjust-amount-input');
            const atmWithdrawalInput = document.getElementById('atm-withdrawal-input');
            const acPaidInput = document.getElementById('ac-paid-input');
            const remarksInput = document.getElementById('remarks-input');

            const grandTotalText = document.getElementById('grand-total').textContent;
            const total = parseInt(grandTotalText.replace('Rs. ', '')) || 0;
            
            // Collect denomination counts
            const data = {
                date: formatDateToDDMMMYYYY(dateInput.value),
                weekExpenses: parseFloat(weekExpensesInput.value) || 0,
                adjustAmount: parseFloat(adjustAmountInput.value) || 0,
                atmWithdrawal: parseFloat(atmWithdrawalInput.value) || 0,
                acPaid: parseFloat(acPaidInput.value) || 0,
                remarks: remarksInput.value,
                d500: 0,
                d200: 0,
                d100: 0,
                d50: 0,
                d20: 0,
                d10: 0,
                d5: 0,
                d2: 0,
                d1: 0,
                total: total
            };
            
            // Map input values to denomination keys
            const denominationMap = {
                '500': 'd500',
                '200': 'd200',
                '100': 'd100',
                '50': 'd50',
                '20': 'd20',
                '10': 'd10',
                '5': 'd5',
                '2': 'd2',
                '1': 'd1'
            };
            
            document.querySelectorAll('.count-input').forEach(input => {
                const value = input.dataset.value;
                const count = parseInt(input.value) || 0;
                const key = denominationMap[value];
                if (key) {
                    data[key] = count;
                }
            });
            
            console.log('Sending data to Google Sheets:', data);
            
            // Save to Google Sheets
            fetch(CONFIG.GOOGLE_SHEET_URL_CASH_COUNTER, {
                method: 'POST',
                body: JSON.stringify(data),
                mode: 'no-cors'
            })
            .then(response => {
                console.log('Data sent to Google Sheets (no-cors mode)');
                loader.classList.add('hidden');
                saveBtn.disabled = false;
                alert('✓ Data cleared  successfully');
                // Also save locally
                localStorage.setItem('cashCounterData', JSON.stringify(data));
                clearAll();
            })
            .catch(error => {
                console.error('Network error:', error);
                loader.classList.add('hidden');
                saveBtn.disabled = false;
                alert('⚠ Error sending data: ' + error.message);
            });
        }

        function loadData() {
            const saved = localStorage.getItem('cashCounterData');
            if (saved) {
                const data = JSON.parse(saved);
                document.querySelectorAll('.count-input').forEach((input, index) => {
                    if (data[`denomination_${index}`]) {
                        input.value = data[`denomination_${index}`];
                    }
                });
                calculate();
            }
        }
        function loadExample() {
            document.querySelectorAll('.count-input').forEach(input => {
                input.value = Math.floor(Math.random() * 5);
            });
            calculate();
        }

        init();
    </script>
    <footer>
        <p>&copy; 2024 <b>Thammineni Technologies</b>. All rights reserved.</p>
    </footer>
</body>

</html>